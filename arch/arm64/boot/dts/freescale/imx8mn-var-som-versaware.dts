// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2019 NXP
 * Copyright 2019-2020 Variscite Ltd.
 */

/dts-v1/;

#include <dt-bindings/usb/pd.h>
#include "imx8mn-var-som.dtsi"

/ {
	model = "Variscite VAR-SOM-MX8M-NANO on Symphony-Board 1.4a and above VersAware";
	compatible = "variscite,var-som-mx8mn", "fsl,imx8mn";

	chosen {
		stdout-path = &uart4;
	};

	leds {
		compatible = "gpio-leds";
		status = "okay";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_leds>;

		led1 {
			label = "led1";
			gpios = <&gpio5 11 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "default-on";
		};

		led2 {
			label = "led2";
			gpios = <&gpio5 10 GPIO_ACTIVE_HIGH>;
			linux,default-trigger = "default-on";
		};

	};

	gpio-keys {
		compatible = "gpio-keys";
		status = "okay";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gpio_keys>;

		back {
			label = "Back";
			gpios = <&gpio5 12 GPIO_ACTIVE_LOW>;
			linux,code = <KEY_BACK>;
			wakeup-source;
		};
	};

	sound-wm8904 {
		status = "disabled";
	};

	weight_reg: regulator-weight {
		compatible = "regulator-fixed";
		regulator-name = "loadcell";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
	};

	weight {
		compatible = "avia,hx711";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_weight>;

		sck-gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;
		dout-gpios = <&gpio5 13 GPIO_ACTIVE_HIGH>;
		clock-frequency = <100000>;
		avdd-supply = <&weight_reg>;
	};
};

&cameradev {
	status = "disabled";
};

&ecspi1 {
	status = "disabled";
};

&fec1 {
	status = "disabled";
};

&flexspi {
	status = "disabled";
};

&gpio2 {
	pinctrl-names = "defualt";
	pinctrl-0 = <&pinctrl_bt>;

	/* disable buffer on som */
	bt-buffer {
		gpio-hog;
		gpios = <6 GPIO_ACTIVE_HIGH>;
		output-high;
	};
};

&gpio5 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_vw_lvds>;

	vw-lvds-backlight {
		gpio-hog;
		gpios = <24 GPIO_ACTIVE_HIGH>;
		output-high;
	};

	vw-lvds-reset {
		gpio-hog;
		gpios = <27 GPIO_ACTIVE_HIGH>;
		output-high;
	};
};


&iomuxc {
	pinctrl-names = "defualt";
	pinctrl-0 = <&pinctrl_bat_chg>;

	pinctrl_bat_chg: bat_chg {
		fsl,pins = <
			MX8MN_IOMUXC_GPIO1_IO13_GPIO1_IO13		0x1c3
			MX8MN_IOMUXC_SAI3_TXC_GPIO5_IO0			0x1c3
			MX8MN_IOMUXC_SAI3_RXD_GPIO4_IO30		0x1c3
			MX8MN_IOMUXC_SAI3_RXC_GPIO4_IO29		0x1c3
                >;
	};

	pinctrl_leds: leds {
		fsl,pins = <
			MX8MN_IOMUXC_ECSPI2_MOSI_GPIO5_IO11         	0x16
			MX8MN_IOMUXC_ECSPI2_SCLK_GPIO5_IO10		0x16
                >;
	};

	pinctrl_touch: goodixtouch{
		fsl,pins = <
			MX8MN_IOMUXC_UART3_RXD_GPIO5_IO26         	0x16
			MX8MN_IOMUXC_UART2_TXD_GPIO5_IO25		0x16
                >;
	};

	pinctrl_vw_lvds: vw_lvds {
		fsl,pins = <
		MX8MN_IOMUXC_UART2_RXD_GPIO5_IO24		0x16 /* backlight */
		MX8MN_IOMUXC_UART3_TXD_GPIO5_IO27		0x16 /* reset */
		MX8MN_IOMUXC_GPIO1_IO08_GPIO1_IO8		0x16 /* stbyb */
		>;
	};

	pinctrl_batmon: batmon {
		fsl,pins = <
			MX8MN_IOMUXC_SAI3_TXFS_GPIO4_IO31			0x06
		>;
	};

	pinctrl_buzzer: buzzer {
		fsl,pins = <
			MX8MN_IOMUXC_SPDIF_RX_PWM2_OUT			0x06
		>;
	};

	pinctrl_gpio_keys: keygrp {
		fsl,pins = <
			MX8MN_IOMUXC_ECSPI2_MISO_GPIO5_IO12		0x1c6
		>;
	};

	pinctrl_i2c2: i2c2grp {
		fsl,pins = <
			MX8MN_IOMUXC_I2C2_SCL_I2C2_SCL			0x400001c3
			MX8MN_IOMUXC_I2C2_SDA_I2C2_SDA			0x400001c3
		>;
	};

	pinctrl_i2c4: i2c4grp {
		fsl,pins = <
			MX8MN_IOMUXC_I2C4_SCL_I2C4_SCL			0x400001c3
			MX8MN_IOMUXC_I2C4_SDA_I2C4_SDA			0x400001c3
		>;
	};

	pinctrl_i2c2_gpio: i2c2grp-gpio {
		fsl,pins = <
			MX8MN_IOMUXC_I2C2_SCL_GPIO5_IO16		0x1c3
			MX8MN_IOMUXC_I2C2_SDA_GPIO5_IO17		0x1c3
		>;
	};

	pinctrl_i2c4_gpio: i2c4grp-gpio {
		fsl,pins = <
			MX8MN_IOMUXC_I2C4_SCL_GPIO5_IO20		0x1c3
			MX8MN_IOMUXC_I2C4_SDA_GPIO5_IO21		0x1c3
		>;
	};

	pinctrl_uart4: uart4grp {
		fsl,pins = <
			MX8MN_IOMUXC_UART4_RXD_UART4_DCE_RX		0x140
			MX8MN_IOMUXC_UART4_TXD_UART4_DCE_TX		0x140
		>;
	};

	pinctrl_weight: weight {
		fsl,pins = <
			MX8MN_IOMUXC_ECSPI2_SS0_GPIO5_IO13		0x1c3
			MX8MN_IOMUXC_SPDIF_TX_GPIO5_IO3		0x1c3
		>;
	};
};

&i2c2 {
	clock-frequency = <100000>;
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_i2c2>;
	pinctrl-1 = <&pinctrl_i2c2_gpio>;
	scl-gpios = <&gpio5 16 GPIO_ACTIVE_HIGH>;
	sda-gpios = <&gpio5 17 GPIO_ACTIVE_HIGH>;
	status = "okay";

	mcp3021@4e {
		compatible = "microchip,mcp3021";
		reg = <0x4e>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_batmon>;
	};
};

&i2c4 {
	clock-frequency = <400000>;
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_i2c4>;
	pinctrl-1 = <&pinctrl_i2c4_gpio>;
	scl-gpios = <&gpio5 20 GPIO_ACTIVE_HIGH>;
	sda-gpios = <&gpio5 21 GPIO_ACTIVE_HIGH>;
	status = "okay";
	
	gt911@14 {
			compatible = "goodix,gt911";
			reg = <0x14>; /* I2C address of GT911. This can also be xBB or x28 or x29 */
			pinctrl-names = "default";
			pinctrl-0 = <&pinctrl_touch>; /* This controls the backlight which we are not using (pwmB) */
			interrupt-parent = <&gpio5>; 
			interrupts = <26 IRQ_TYPE_EDGE_RISING>;
			irq-gpios = <&gpio5 26 GPIO_ACTIVE_HIGH>; /* This pin should be active when bluetooth function is disabled */ 
			reset-gpios = <&gpio5 25 GPIO_ACTIVE_HIGH>; /* This pin should be active when bluetooth function is disabled */ 
                       touchscreen-size-x = <800>; /* pixel size width */
		        touchscreen-size-y = <480>; /* pixel size height */
		        status = "okay";
			wakeup-source;
	};
};

&pwm2 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_buzzer>;
};

&dsi_lvds_bridge {
	ti,dsi-lanes = <1>;
	ti,lvds-format = <2>; /* done, format 1 <1> must be selected when RGB888(24bpp) data is received from DSI */
	ti,lvds-bpp = <24>; /* done, 24 bits of data each lane */
	ti,lvds-channels = <1>; /* done, one main channel */
	ti,width-mm = <108>; /* done, pixel active area width */
	ti,height-mm = <65>; /* done, pixel active area height */

	display-timings {
		lvds {
			clock-frequency = <25000000>; /* done, changed from 33MHz to 25MHz */
			hactive = <800>; /* done, unchanged pixel height */
			vactive = <480>; /* done, unchanged pixel height */
			hback-porch = <8>; /* done, changed hback from 40 to 8 */
			hfront-porch = <8>; /* done, changed hfront from 40 to 8 */
			vback-porch = <8>; /* done, changed vback from 29 to 8 */
			vfront-porch = <8>; /* done, changed vfront from 13 to 8 */
			hsync-len = <4>; /* done, changed hsync from 48 to 4. Related to pulse width */
			vsync-len = <4>; /* done, changed vsync from 3 to 4. Related to pulse width */
			hsync-active = <0>; /* done, unchanged but may need to test */
			vsync-active = <0>; /* done, unchanged but may need to test */
			de-active = <1>; /* done, unchanged but may need to test */
			pixelclk-active = <0>; /* done, unchanged but may need to test */
		};
	};
};

&snvs_pwrkey {
	status = "okay";
};

&snvs_rtc {
	status = "disabled";
};

&uart2 {
	status = "disabled";
};

/* Console */
&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart4>;
	status = "okay";
	/delete-property/ dmas;
	/delete-property/ dma-names;
};

&usbotg1 {
	dr_mode = "peripheral";
	picophy,pre-emp-curr-control = <3>;
	picophy,dc-vol-level-adjust = <7>;
	hnp-disable;
	srp-disable;
	adp-disable;
	status = "okay";
};

&sai5 {
	status = "disabled";
};

&wm8904 {
	status = "disabled";
};
